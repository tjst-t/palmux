# Palmux 用語集

Claude Code との指示・会話で使う共通用語を定義する。
新機能・新 UI を追加したらこのファイルも必ず更新すること。

---

## 画面レイアウト全体

```
┌──────────────────────────────────────────┐
│ ☰ [0:zsh][1:vim][📁Files][⑂Git]      ▼  │  ← ヘッダー（タブバー）
├──────────────────────────────────────────┤
│                                          │
│              ターミナル                  │  ← ターミナル領域
│                                          │
├──────────────────────────────────────────┤
│ [IME 入力フィールド              ] [送信] │  ← IME バー（表示時のみ）
├──────────────────────────────────────────┤
│< [あ][Esc][Tab][Ctrl][Alt][/][-][↑↓←→⌫↵] >│  ← ツールバー（通常モード）
└──────────────────────────────────────────┘
```

---

## ヘッダー

画面最上部のバー。

| 用語 | 説明 |
|---|---|
| **ヘッダー** | 画面最上部のバー。ハンバーガーアイコン・セッション:ウィンドウ表示・接続状態ドロップダウンを含む |
| **ハンバーガーアイコン** (`☰`) | ヘッダー左端のアイコン。タップで**ドロワー**を開く |
| **セッション:ウィンドウ表示** | ヘッダー中央の `main:0` 形式のテキスト。現在接続中のセッション名とウィンドウインデックスを示す |
| **接続状態ドロップダウン** (`▼`) | ヘッダー右端。現在の WebSocket 接続状態（connected / connecting / disconnected）を表示。タップで詳細メニューを開く |

---

## ドロワー

ハンバーガーアイコンをタップすると左からスライドして現れるパネル。

| 用語 | 説明 |
|---|---|
| **ドロワー** | プロジェクト・ブランチの一覧と操作メニュー。画面左からスライドイン |
| **プロジェクト** | ghq リポジトリに対応するドロワーの最上位グループ。クリックで展開し、ブランチ一覧を表示する |
| **ブランチ** | プロジェクト内の git ブランチ。各ブランチに tmux セッションと git worktree が対応する |
| **デフォルトブランチセッション** | プロジェクトのメインリポジトリに対応するセッション。セッション名 = プロジェクト名（`@` なし） |
| **Worktree セッション** | `git worktree` で作成されたブランチに対応するセッション。セッション名 = `{project}@{branch}` |
| **Open Branch** | プロジェクト展開時の「Open Branch...」ボタン。ブランチピッカーを表示する |
| **ブランチピッカー** | ブランチ一覧をフィルタ付きで表示し、選択するとworktree + セッションを作成して接続するUI |
| **Other Sessions** | ghq リポジトリに対応しない tmux セッションをまとめる折りたたみセクション |
| **ドロワーオーバーレイ** | ドロワー表示中に背景を覆う半透明の黒いレイヤー。タップでドロワーを閉じる |

---

## ターミナル領域

| 用語 | 説明 |
|---|---|
| **ターミナル** | xterm.js で描画される端末エミュレータ領域 |
| **ターミナルコンテナ** | xterm.js を DOM にマウントする `<div>` 要素 |
| **再接続オーバーレイ** | 切断中に "Reconnecting..." を表示する半透明の覆い |
| **パネル** | ターミナル・ファイルブラウザ・Git ブラウザ・ツールバー・IME バーを一体として管理する単位。スプリットモードでは左右 2 つ存在する |
| **スプリットモード** | 画面を左右 2 分割して 2 つのパネルを同時表示するモード |

---

## タブバー

ヘッダー内に配置される横スクロール可能なタブ UI。現在のセッションのウィンドウ + Files + Git をワンタップで切り替える。

| 用語 | 説明 |
|---|---|
| **タブバー** | ヘッダー内の横スクロールタブ UI。ターミナル接続時にヘッダータイトルの代わりに表示される |
| **タブ** | タブバー内の個々のボタン。ターミナルウィンドウ・Files・Git の 3 種類がある |
| **アクティブタブ** | 現在表示中のタブ。下線インジケーター（`tab--active`）で示される |
| **タブキャッシュ** | パネル内の `_tabCache` Map。タブ切り替え時にターミナル・ブラウザのインスタンスを保持し、WebSocket 再接続なしで即座に切り替える |
| **タブキー** | タブキャッシュのキー文字列。`"terminal:0"`, `"terminal:1"`, `"files"`, `"git"` の形式 |
| **通知バッジ** | バックグラウンドウィンドウのアクティビティを示す黄色い小さなドット（`tab-notification`） |
| **＋ボタン (Add Button)** | タブバー右端のウィンドウ作成ボタン。タップで新しい Bash ウィンドウを作成する |
| **タブコンテキストメニュー** | タブの右クリック（デスクトップ）または長押し 500ms（モバイル）で表示される操作メニュー。通常タブには Rename / Delete、Claude タブには Restart / Resume を表示する |

---

## ビュー切り替え

パネル内でターミナル・ファイルブラウザ・Git ブラウザを切り替える仕組み。
タブバーのタブタップで切り替える。

| 用語 | 説明 |
|---|---|
| **ターミナルビュー** | xterm.js ターミナル + IME バー + ツールバーを表示するモード（デフォルト）。タブバーのウィンドウタブで切り替え |
| **ファイルブラウザビュー** | ファイルブラウザを表示するモード。タブバーの Files タブで切り替え |
| **Git ブラウザビュー** | Git ブラウザを表示するモード。タブバーの Git タブで切り替え |

---

## ファイルブラウザ

| 用語 | 説明 |
|---|---|
| **ファイルブラウザ** | セッションのプロジェクトディレクトリを閲覧できる UI |
| **パンくずリスト** | ファイルブラウザ上部のディレクトリパス表示。タップで上位ディレクトリへ移動 |
| **ファイルプレビュー** | ファイルタップ時に表示されるコンテンツビュー。Markdown・コード（シンタックスハイライト）・画像・HTML レンダリングに対応 |
| **プロジェクトディレクトリ** | セッションに紐づくルートディレクトリ。`ghq` リポジトリを優先検出し、なければカレントパス |

---

## Git ブラウザ

| 用語 | 説明 |
|---|---|
| **Git ブラウザ** | セッションのプロジェクトディレクトリの Git 情報を閲覧できる UI |
| **Git ステータス** | `git status` の結果を一覧表示する画面 |
| **Git ログ** | `git log` のコミット一覧を表示する画面 |
| **Git ブランチ一覧** | ブランチの一覧と現在のブランチを表示する画面 |
| **Git diff ビュー** | ファイルの変更差分を表示する画面 |

---

## ツールバー

ターミナルビュー下部の操作バー。3 つのモードを持つ。

```
通常モード:
< [あ] [Esc][Tab][Ctrl][Alt][/][-]  [↑][↓][←][→][⌫][↵] >

ショートカットモード（> で切り替え）:
< [^C][^Z][^D][^O][^L][^R][^A][^E][^W][^U][^K]

コマンドモード（< で切り替え）:
[build][test][lint]... >
```

### ツールバーのモード

| 用語 | 説明 |
|---|---|
| **ツールバー** | ターミナル下部の操作バー全体 |
| **通常モード** | デフォルト状態。左グループ・右グループ・IME ボタンを表示 |
| **ショートカットモード** | `>` ボタンで遷移。Ctrl 系キー（^C, ^Z 等）のボタン列を表示 |
| **コマンドモード** | `<` ボタンで遷移。プロジェクトコマンドのボタン列を表示 |
| **モード切替ボタン `>`** | ツールバー右端の絶対配置ボタン。通常→ショートカット / コマンドモード→通常 に切り替え |
| **モード切替ボタン `<`** | ツールバー左端の絶対配置ボタン。通常→コマンド / ショートカットモード→通常 に切り替え |

### 通常モードのボタン

| 用語 | 説明 |
|---|---|
| **IME ボタン** (`あ`) | キーボードモードを循環切り替えする。none → direct → ime → none |
| **左グループ** | Esc・Tab・Ctrl・Alt・`/`・`-` を含むボタン群 |
| **右グループ** | ↑↓←→・Backspace（`⌫`）・Enter（`↵`）を含むボタン群 |
| **修飾キーボタン** | Ctrl・Alt ボタン。タップでワンショット、長押しでロック状態に遷移 |
| **ワンショット** | 修飾キーが次の 1 キー入力にのみ適用される状態 |
| **ロック** | 修飾キーが明示的に解除するまで連続適用される状態 |
| **ポップアップキー** | `/` と `-` ボタンを上方向にスワイプすると表示される代替キー（`|` と `_`） |
| **キーリピート** | 矢印キー・Backspace を押し続けると連続入力されるリピート機能 |

### ショートカットモードのボタン

| 用語 | 説明 |
|---|---|
| **ショートカット行** | ショートカットモード時に表示されるボタン列（横スクロールなし・最大 2 段） |
| **ショートカットボタン** | ^C / ^Z / ^D / ^O / ^L / ^R / ^A / ^E / ^W / ^U / ^K の各ボタン |

### コマンドモードのボタン

| 用語 | 説明 |
|---|---|
| **コマンド行** | コマンドモード時に表示されるボタン列（最大 2 段、左端から配置） |
| **コマンドボタン** | プロジェクトコマンドを 1 タップで実行する緑系ボタン |
| **コマンドキャッシュ** | 同一セッション内でのコマンド一覧の 30 秒キャッシュ |

### Claude モード

Claude ウィンドウのターミナルタブ表示時に、コマンドモードの代わりに使用される専用ツールバーモード。

```
Claude モード:
[y] [n] [↑] [⏎] [^C] [Esc]          ← クイックアクション行
[/compact] [/clear] [/help] [/cost] [/status]  ← スラッシュコマンド行（横スクロール）
```

| 用語 | 説明 |
|---|---|
| **Claude モード** | Claude ウィンドウ表示時にコマンドモードを置き換える専用モード。`<` ボタンまたは右スワイプで遷移 |
| **クイックアクション行** | Claude モード上段。承認（y/n）、カーソル上、Enter、^C、Esc の 6 ボタンを均等配置 |
| **スラッシュコマンド行** | Claude モード下段。Claude Code のスラッシュコマンドを横スクロール可能なボタン列で配置 |
| **Claude 通知バッジ** | Claude ウィンドウのバックグラウンド通知を示す赤色パルスアニメーション付きバッジ（`tab-notification--claude`） |
| **承認待ち通知** | Claude ウィンドウで新規通知発生時にバイブレーション（`navigator.vibrate`）とブラウザ通知（`Notification API`）を送る機能 |

---

## IME バー

| 用語 | 説明 |
|---|---|
| **IME バー** | 日本語等の変換入力用テキストフィールドを含むバー。ツールバー上に表示 |
| **IME 入力フィールド** | IME バー内のテキスト入力欄。Enter で確定テキストを pty に送信 |
| **キーボードモード** | IME ボタンで切り替わる 3 状態: `none`（キーボード非表示）/ `direct`（直接入力）/ `ime`（IME フィールド表示） |

---

## 接続・通信

| 用語 | 説明 |
|---|---|
| **セッション** | tmux セッション。複数のウィンドウを持つ |
| **ウィンドウ** | tmux ウィンドウ。インデックス番号で識別される |
| **接続** | WebSocket による pty へのアタッチ状態 |
| **自動再接続** | 切断時に指数バックオフで再接続を試みる仕組み |
| **グループセッション** | 同一ウィンドウへの複数接続を実現するために内部的に作成される tmux セッション |
| **PTY ブリッジ** | WebSocket と tmux の pty を双方向に中継する仕組み |
| **Bearer トークン** | 認証に使う秘密トークン。起動時に自動生成。URL クエリパラメータ `?token=` でも指定可能 |

---

## コマンド検出

| 用語 | 説明 |
|---|---|
| **コマンド検出** | プロジェクトディレクトリの設定ファイルからコマンドを自動検出する機能（`internal/cmddetect`） |
| **検出対象ファイル** | Makefile・package.json・Cargo.toml・pyproject.toml・go.mod |
| **Makefile ターゲット** | Makefile から抽出したターゲット名。`make <target>` コマンドを生成 |
| **npm スクリプト** | package.json の `scripts` オブジェクトのキー。`npm run <name>` コマンドを生成 |
| **定型コマンド** | Cargo.toml・pyproject.toml・go.mod が存在する場合に提供する固定コマンドセット（Makefile がない場合のみ） |

---

## PWA・ネットワーク

| 用語 | 説明 |
|---|---|
| **PWA** | Progressive Web App。ホーム画面に追加してネイティブアプリ風に使用できる |
| **Service Worker** | PWA の offline キャッシュと通知を担う background スクリプト |
| **ベースパス** | `--base-path` で設定するルートプレフィックス（例: `/palmux/`）。リバースプロキシ配下での運用に使用 |
| **TLS** | HTTPS/WSS での暗号化通信。`--tls-cert` と `--tls-key` で有効化 |

---

## バックエンド内部

| 用語 | 説明 |
|---|---|
| **TmuxManager** | tmux 操作を抽象化する Go インターフェース（`internal/server` から参照） |
| **Executor** | tmux コマンド実行を抽象化する Go インターフェース（テスト時にモック注入） |
| **FileServer** | ファイル一覧・読み取り・パス検証を担うパッケージ（`internal/fileserver`） |
| **パストラバーサル防止** | `../` 等でプロジェクトルート外へのアクセスを禁止する検証ロジック |
| **ghq** | Go 製のリポジトリ管理ツール。プロジェクトディレクトリの検出に使用 |
| **接続トラッカー** | 同一セッションへの同時接続数を管理する仕組み。最大数は `--max-connections` で設定 |
| **通知ストア** | バックグラウンドウィンドウでのアクティビティ通知を保持するメモリストア |

---

## Claude Code モード

ghq セッションで自動的に有効になるモード。Claude Code での開発に最適化されたウィンドウ構成を強制する。

| 用語 | 説明 |
|---|---|
| **Claude Code モード** | ghq リポジトリに対応するセッションで自動的に有効になるモード。claude ウィンドウ + shell ウィンドウの構成を強制する |
| **claude ウィンドウ** | Claude Code モードで自動作成される `claude` コマンド起動済みウィンドウ。削除・リネーム不可（protected） |
| **モード API** | `GET /api/sessions/{session}/mode` エンドポイント。セッションが Claude Code モードかどうかと claude ウィンドウの index を返す |
| **IsGhqSession** | セッション名が ghq リポジトリに対応するかを判定するメソッド。`GhqResolver.Resolve()` の結果が HomeDir でなければ true |
| **EnsureClaudeWindow** | ghq セッションに claude ウィンドウが存在することを保証するメソッド。既存なら返し、なければ新規作成 |
| **ReplaceClaudeWindow** | 既存の claude ウィンドウを kill して同名で再作成するメソッド。リスタート・レジューム機能の基盤 |
| **claude リスタート API** | `POST /api/sessions/{session}/claude/restart` エンドポイント。ghq セッション限定で claude ウィンドウを再起動する |
| **リスタート** | claude ウィンドウを新しいセッションとして再起動する操作。ドロワーのコンテキストメニューから Restart を選択 |
| **レジューム** | claude ウィンドウを `--continue` 付きで再起動し、前回のセッションを継続する操作。ドロワーのコンテキストメニューから Resume を選択 |

---

## 開発ツール

| 用語 | 説明 |
|---|---|
| **dev-serve.sh** | TLS 証明書の生成（期限切れ時のみ）・ビルド・サーバー起動をまとめたスクリプト |
| **configurableMock** | テスト用の TmuxManager モック実装（`internal/server` テストファイルで定義） |
| **testdata/** | tmux コマンド出力のフィクスチャファイルを置くディレクトリ |
